'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Input = (function () {
  function Input() {
    _classCallCheck(this, Input);

    this.apiKey = '';
    this.requestUrl = 'http://api.themoviedb.org/3';
    this.baseUrl = '';
    this.trailerBase = 'https://www.youtube.com/results';
    this.posterSize = 4;
    this.minVotes = 50;
    this.minAverage = 6.0;
    this.data = {
      genres: {
        4: 'Action',
        21: 'Comedy',
        3: 'Romance',
        20: 'Drama',
        2: 'Animation',
        19: 'Thriller',
        1: 'Western',
        18: 'Horror'
      },
      years: {
        1940: '40s',
        1950: '50s',
        1960: '60s',
        1970: '70s',
        1980: '80s',
        1990: '90s',
        2000: '00s',
        2010: '10s'
      },
      result: false,
      selected: {
        genre: false,
        year: false
      },
      options: {
        genres: false,
        years: false,
        other: false
      }
    };
  }

  _createClass(Input, [{
    key: 'convertSelection',
    value: function convertSelection() {
      var parameters = '';

      if (this.data.selected.year) {
        var year = parseInt(this.data.selected.year);

        parameters = '&primary_release_date.gte=' + year + '-01-01&primary_release_date.lte=' + (year + 9) + '-12-31';
      }

      return parameters;
    }
  }, {
    key: 'randomize',
    value: function randomize(amount) {
      return Math.ceil(Math.random() * amount);
    }
  }, {
    key: 'createPath',
    value: function createPath() {
      this.data.result.poster = this.baseUrl + input.posterSize + this.data.result.backdrop_path;
    }
  }, {
    key: 'setYear',
    value: function setYear() {
      this.data.result.year = this.data.result.release_date.slice(0, 4);
    }
  }, {
    key: 'setTrailer',
    value: function setTrailer() {
      var title = this.data.result.title.replace(/\s/g, '+').toLowerCase();

      this.data.result.trailer = this.trailerBase + '?search_query=' + title + '+' + this.data.result.year + '+trailer';
    }
  }]);

  return Input;
})();

var input = new Input();
'use strict';

Vue.config.debug = true;

!(function () {

  var app = new Vue({
    el: '#app',
    data: input.data,
    ready: function ready() {
      this.$http.get(input.requestUrl + '/configuration?api_key=' + input.apiKey, function (data) {
        input.baseUrl = data.images.base_url;
        input.posterSize = data.images.poster_sizes[input.posterSize];
      });

      // this.$http.get(input.requestUrl + '/genre/movie/list?api_key=' + input.apiKey, function(data) {
      //   console.log(data);
      // });
    },

    methods: {
      activeGenre: function activeGenre(genre) {
        return genre == input.data.selected.genre;
      },
      activeYear: function activeYear(year) {
        return year == input.data.selected.year;
      },
      filterGenre: function filterGenre(genre) {
        if (input.data.selected.genre == genre) {
          input.data.selected.genre = false;
        } else {
          input.data.selected.genre = genre;
        }
      },
      filterYear: function filterYear(year) {
        if (input.data.selected.year == year) {
          input.data.selected.year = false;
        } else {
          input.data.selected.year = year;
        }
      },
      recommend: function recommend() {
        input.data.result = {};

        var parameters = input.convertSelection();
        var request = input.requestUrl + '/discover/movie?api_key=' + input.apiKey + parameters + '&vote_count.gte=' + input.minVotes + '&vote_average.gte=' + input.minAverage;

        this.$http.get(request, function (data) {
          var page = input.randomize(data.total_pages);

          this.$http.get(request + '&page=' + page, function (data) {
            var result = input.randomize(data.results.length) - 1;

            input.data.result = data.results[result];

            input.createPath();
            input.setYear();
            input.setTrailer();
          });
        });
      }
    }
  });
})();