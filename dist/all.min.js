'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Input = (function () {
  function Input() {
    _classCallCheck(this, Input);

    this.apiKey = '';
    this.requestUrl = 'http://api.themoviedb.org/3';
    this.baseUrl = '';
    this.trailerBase = 'https://www.youtube.com/results';
    this.posterSize = 4;
    this.minVotes = 50;
    this.minAverage = 6.0;
    this.data = {
      genres: {},
      years: {},
      ready: true,
      result: false,
      selected: {
        genres: [],
        year: false,
        lesserKnown: false,
        bad: false
      },
      options: {
        genres: false,
        years: false,
        other: false
      }
    };
  }

  _createClass(Input, [{
    key: 'setBaseConfig',
    value: function setBaseConfig(data) {
      input.baseUrl = data.images.base_url;
      input.posterSize = data.images.poster_sizes[input.posterSize];
    }
  }, {
    key: 'populateGenres',
    value: function populateGenres(data) {
      var genres = {};

      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = data.genres[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var genre = _step.value;

          genres[genre.id] = genre.name;
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      this.data.genres = genres;
    }
  }, {
    key: 'populateYears',
    value: function populateYears() {
      this.data.years = {
        1940: '40s',
        1950: '50s',
        1960: '60s',
        1970: '70s',
        1980: '80s',
        2000: '00s',
        2010: '10s'
      };
    }
  }, {
    key: 'convertSelection',
    value: function convertSelection() {
      var parameters = '';

      if (this.data.selected.genres.length > 0) {
        parameters += '&with_genres=' + this.data.selected.genres.join('|');
      }

      if (this.data.selected.year) {
        var year = parseInt(this.data.selected.year);

        parameters += '&primary_release_date.gte=' + year + '-01-01&primary_release_date.lte=' + (year + 9) + '-12-31';
      }

      if (this.data.selected.lesserKnown) {
        this.defaultVotes = this.minVotes;
        this.minVotes = 10;
      } else if (this.defaultVotes) {
        this.minVotes = this.defaultVotes;
      }

      if (this.data.selected.bad) {
        this.defaultAverage = this.minAverage;
        this.minAverage = 1.0;
      } else if (this.defaultAverage) {
        this.minAverage = this.defaultAverage;
      }

      return parameters;
    }
  }, {
    key: 'randomize',
    value: function randomize(amount) {
      return Math.ceil(Math.random() * amount);
    }
  }, {
    key: 'createPath',
    value: function createPath() {
      if (this.data.result.backdrop_path) {
        this.data.result.poster = this.baseUrl + input.posterSize + this.data.result.backdrop_path;
      }
    }
  }, {
    key: 'setYear',
    value: function setYear() {
      this.data.result.year = this.data.result.release_date.slice(0, 4);
    }
  }, {
    key: 'setTrailer',
    value: function setTrailer() {
      var title = this.data.result.title.replace(/\s/g, '+').toLowerCase();

      this.data.result.trailer = this.trailerBase + '?search_query=' + title + '+' + this.data.result.year + '+trailer';
    }
  }]);

  return Input;
})();

var input = new Input();
'use strict';

Vue.config.debug = true;

!(function () {

  var app = new Vue({

    el: '#app',

    data: input.data,

    ready: function ready() {
      this.$http.get(input.requestUrl + '/configuration?api_key=' + input.apiKey, function (data) {
        input.setBaseConfig(data);
      });

      this.$http.get(input.requestUrl + '/genre/movie/list?api_key=' + input.apiKey, function (data) {
        input.populateGenres(data);
      });

      input.populateYears();
    },

    methods: {
      activeGenre: function activeGenre(genre) {
        return this.selected.genres.indexOf(genre) != -1;
      },

      activeYear: function activeYear(year) {
        return year == this.selected.year;
      },

      active: function active(type) {
        return type == this.selected[type];
      },

      filterGenre: function filterGenre(genre) {
        if (!this.activeGenre(genre)) {
          this.selected.genres.push(genre);
        } else {
          this.selected.genres.splice(this.selected.genres.indexOf(genre), 1);
        }
      },

      filterYear: function filterYear(year) {
        if (!this.activeYear(year)) {
          this.selected.year = year;
        } else {
          this.selected.year = false;
        }
      },

      filter: function filter(type) {
        if (!this.active(type)) {
          this.selected[type] = type;
        } else {
          this.selected[type] = false;
        }
      },

      recommend: function recommend() {
        this.result = {};

        var parameters = input.convertSelection();
        var request = input.requestUrl + '/discover/movie?api_key=' + input.apiKey + parameters + '&vote_count.gte=' + input.minVotes + '&vote_average.gte=' + input.minAverage;

        this.$http.get(request, function (data) {
          var page = input.randomize(data.total_pages);

          this.$http.get(request + '&page=' + page, function (data) {
            var result = input.randomize(data.results.length) - 1;

            this.result = data.results[result];

            input.createPath();
            input.setYear();
            input.setTrailer();
          });
        });
      }
    }

  });
})();